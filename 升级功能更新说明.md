# 升级功能与消息颜色更新

## ✨ 新功能特性

### 1. 玩家地产升级交互

当玩家（不是AI）经过自己的地产时：

1. **检查升级条件**
   - 地产等级 < 5 级
   - 玩家现金足够支付升级成本
   
2. **等待玩家决策**
   - 界面显示"升级"和"跳过"按钮
   - 玩家可自主选择是否升级
   
3. **升级效果**
   - 点击"升级"：地产等级 +1，支付升级成本
   - 点击"跳过"：保持原等级，继续下一步

### 2. AI升级行为

AI 经过自己地产时：
- **70% 自动升级**（如果满足升级条件）
- **30% 保持观望**（不进行升级）

### 3. 消息颜色区分

#### 玩家回合（蓝色系）
- 浅蓝色→深蓝色的渐变
- 最新消息颜色最深
- 表示当前是玩家的行动阶段

#### AI回合（红色系）
- 浅红色→深红色的渐变
- 最新消息颜色最深
- 表示当前是AI的行动阶段

#### 效果说明
```
玩家回合消息：
  [浅蓝] 轮到 玩家 行动
  [中蓝] 投掷骰子: 4
  [深蓝] 到达自己的地产（等级1）

AI回合消息：
  [浅红] 轮到 AI 行动
  [中红] 投掷骰子: 5
  [深红] 升级了 地产2！
```

## 🎮 操作流程

### 玩家地产升级流程

```
1. 玩家经过自己的地产
   ↓
2. 检查是否可升级（等级<5且现金充足）
   ↓
3. 显示升级按钮
   ├→ 点击"升级"
   │  ├→ 扣除升级成本
   │  └→ 等级 +1
   │
   └→ 点击"跳过"
      └→ 保持原等级
   ↓
4. 支付维护成本（如果等级>0）
   ↓
5. 回合结束
```

### 消息区分示例

**玩家回合**（蓝色消息）：
```
点击'投掷骰子'开始游戏
轮到 玩家 行动
投掷骰子: 3
到达自己的地产 地产5（等级0）
-> 可升级！升级成本 $120（新等级1/5）
-> 是否升级？点击升级或跳过按钮
```

**AI回合**（红色消息）：
```
轮到 AI 行动
投掷骰子: 5
支付 $60 租金给 玩家（地产等级1）
升级了 地产8！
```

## 📝 代码改动总结

### GameManager 新增
- `waiting_for_upgrade_decision`：升级等待标志
- `upgrade_property`：当前升级选择的地产
- `player_upgrade_decision()`：处理玩家升级决策

### UI 新增
- `upgrade_button`：升级按钮（位置：460）
- `upgrade_skip_button`：跳过按钮（位置：520）
- 按钮只在等待升级决策时显示

### Renderer 改进
- `draw_messages()` 新增 `is_player_turn` 参数
- 根据当前玩家自动调整消息颜色
- 蓝色系（玩家）↔ 红色系（AI）

### Main 改动
- 升级按钮点击处理
- 升级按钮渲染控制
- 根据玩家轮次传递颜色信息

## 🎯 游戏体验改进

✅ **更好的交互**：玩家可主动控制升级决策  
✅ **视觉反馈**：消息颜色清晰区分轮次  
✅ **平衡性**：玩家升级更灵活，AI有升级概率  
✅ **易读性**：回合日志更容易追踪

## 🔧 配置说明

调整 `config.py` 中的参数：

```python
PROPERTY_UPGRADE_RATE = 0.2          # 升级成本率
PROPERTY_MAINTENANCE_RATE = 0.05     # 维护成本率
PROPERTY_MAX_LEVEL = 5               # 最高等级
```

---

**版本**：1.1  
**更新内容**：添加玩家升级交互和消息颜色区分  
**最后更新**：2025-10-24
